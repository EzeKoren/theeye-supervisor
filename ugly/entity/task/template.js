"use strict";var mongodb=require("../../lib/mongodb").db,BaseSchema=require("./schema"),Script=require("../script").Entity,TemplateSchema=BaseSchema.EntitySchema.extend({script_id:{type:String,ref:"Script"},script_arguments:{type:Array,default:[]},script_runas:{type:String,default:""},type:{type:String,default:"script"}});TemplateSchema.methods.values=function(){var e=this;return{name:e.name,description:e.description,script_id:e.script_id,script_arguments:e.script_arguments}},TemplateSchema.methods.publish=function(e){var t=this.toObject();return this.script_id?void Script.findById(this.script_id,function(r,o){return r||!o?e(t):(t.script_name=o.filename,void e(t))}):e()};var updateFn=TemplateSchema.methods.update;TemplateSchema.methods.update=function(e){e._type="TaskTemplate",updateFn.apply(this,arguments)};var Entity=mongodb.model("TaskTemplate",TemplateSchema);Entity.ensureIndexes(),exports.Entity=Entity;
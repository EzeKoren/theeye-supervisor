"use strict";var mongodb=require("../lib/mongodb"),Schema=require("mongoose").Schema,EntitySchema=Schema({token:{type:String,index:!0},client_id:{type:String,index:!0},client_secret:{type:String},email:{type:String,unique:!0,required:!0,dropDups:!0},emails:{type:Array,default:[]},customers:[{customer:{type:Schema.Types.ObjectId,ref:"Customer"},_id:String,name:String}],username:{type:String,required:!1},credential:{type:String,default:null},enabled:{type:Boolean,default:!1},last_update:{type:Date,default:new Date},creation_date:{type:Date,default:new Date},timestamp:{type:String,default:Date.now()}});EntitySchema.methods.publish=function(e,t){var r=this;e=e||{},t=t||function(){};var o={id:r._id,token:r.token,client_id:r.client_id,email:r.email,customers:r.customers,credential:r.credential,enabled:r.enabled,last_update:r.last_update,creation_date:r.creation_date};return e.publishSecret&&(o.client_secret=r.client_secret),e.populateCustomers?Entity.populate(r,{path:"customers.customer"},function(e,r){for(var n=[],i=0;i<r.customers.length;i++)n.push(r.customers[i].customer.publish());o.customers=n,t(null,o)}):t(null,o),o};var Entity=mongodb.db.model("User",EntitySchema);Entity.ensureIndexes(),exports.Entity=Entity;
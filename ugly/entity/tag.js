"use strict";var mongodb=require("../lib/mongodb"),mongoose=require("mongoose"),Schema=mongoose.Schema,lodash=require("lodash"),EntitySchema=Schema({name:{type:String},creation_date:{type:Date,default:new Date},customer:{type:Schema.Types.ObjectId,ref:"Customer"}});EntitySchema.virtual("id").get(function(){return this._id.toHexString()});var specs={getters:!0,virtuals:!0,transform:function(e,t,r){t.id=t._id,delete t._id,delete t._type,delete t.__v}};EntitySchema.set("toJSON",specs),EntitySchema.set("toObject",specs),EntitySchema.statics.create=function(e,t,r){if(r||(r=function(){}),!e||0===e.length)return r();var o=e.map(function(e){return{name:e,customer:mongoose.Types.ObjectId(t._id)}}),n=[],i=lodash.after(o.length,function(){return r(null,n)});o.forEach(function(e){Entity.findOne(e,function(t,r){r?(n.push(r),i()):(r=new Entity(e),r.save(function(e){e||n.push(r),i()}))})})},EntitySchema.index({name:1,customer:1},{unique:!0});var Entity=mongodb.db.model("Tag",EntitySchema);Entity.ensureIndexes(),exports.Entity=Entity;
"use strict";require("mongoose-schema-extend");var ObjectId=require("mongoose").Schema.Types.ObjectId,mongodb=require("../../lib/mongodb").db,BaseSchema=require("./schema"),Template=require("./template").Entity,Resource=require("../resource").Entity,logger=require("../../lib/logger")("eye:entity:monitor"),properties={host_id:{type:String,required:!0},host:{type:ObjectId,ref:"Host"},resource:{type:ObjectId,ref:"Resource"},resource_id:{type:String},enable:{type:Boolean,default:!0},creation_date:{type:Date,default:Date.now},last_update:{type:Date,default:Date.now},template:{type:ObjectId,ref:"MonitorTemplate",default:null}},MonitorSchema=BaseSchema.EntitySchema.extend(properties);MonitorSchema.methods.publish=function(e,t){e=e||{},e.populate?Entity.populate(this,{path:"resource"},function(e,r){r.resource?t(e,r.toObject()):(logger.error("monitor.resource is null. could not populate"),t(e))}):t(null,this.toObject())},MonitorSchema.methods.toTemplate=function(e){var t=this,r={};for(var o in BaseSchema.properties)r[o]=t[o];var n=new Template(r);n.save(function(t){e(t,n)})},MonitorSchema.methods.update=function(e,t){var r=this;r.setUpdates(e,function(e,o){Entity.update({_id:r._id},o,t)})};var Entity=mongodb.model("ResourceMonitor",MonitorSchema);Entity.ensureIndexes(),exports.Entity=Entity;
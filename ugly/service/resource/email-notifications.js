"use strict";function searchTypeEvent(e,t){if(!ResourceTypes.hasOwnProperty(e))throw new Error('resource type "'+e+'" is invalid or not defined');if(!(e!=Constants.RESOURCE_TYPE_DSTAT&&e!=Constants.RESOURCE_TYPE_PSAUX||t!=Constants.RESOURCE_STOPPED&&t!=Constants.RESOURCE_RECOVERED&&t))throw new Error(e+"/"+t+" event ignored.");var r=ResourceTypes[e],n=r.events;if(0!==n.length)for(var s=0;s<n.length;s++){var i=n[s];if(i.name==t)return i}return defaultTypeEvent(t)}function defaultTypeEvent(e){var t;switch(e){case Constants.RESOURCE_FAILURE:t={message:function(e,t){return e.hostname+" "+e.description+" checks failed."},subject:function(e,t){return"[HIGH] "+e.description+" failure"}};break;case Constants.RESOURCE_NORMAL:t={message:function(e,t){return e.hostname+" "+e.description+" checks recovered."},subject:function(e,t){return"[HIGH] "+e.description+" recovered"}};break;case Constants.RESOURCE_RECOVERED:t={message:function(e,t){return e.hostname+" "+e.description+" start reporting updates again."},subject:function(e,t){return"[HIGH] "+e.description+" recovered"}};break;case Constants.RESOURCE_STOPPED:t={message:function(e,t){return e.hostname+" "+e.description+" stopped reporting updates."},subject:function(e,t){return"[HIGH] "+e.description+" unreachable"}};break;case Constants.AGENT_STOPPED:t={message:function(e,t){return e.hostname+" host agent stopped reporting updates."},subject:function(e,t){return"[HIGH] "+e.hostname+" unreachable"}};break;default:t={message:function(t,r){return t.hostname+" "+t.description+' reported an unknown state "'+e+'".'},subject:function(e,t){return"[HIGH] "+e.description+" error"}}}return t}var format=require("util").format,debug=require("debug")("eye:supervisor:service:resource:email-notifications"),Constants=require("../../constants/monitors"),ResourceTypes={dstat:{type:"dstat",events:[{severity:"LOW",name:"host:stats:cpu:high",message:function(e,t){return e.hostname+" cpu check failed. "+t.cpu+"% CPU in use"},subject:function(e,t){return"["+this.severity+"] "+e.hostname+" CPU alert"}},{severity:"LOW",name:"host:stats:mem:high",message:function(e,t){return e.hostname+" mem check failed. "+t.mem+"% MEM in use"},subject:function(e,t){return"["+this.severity+"] "+e.hostname+" MEM alert"}},{severity:"LOW",name:"host:stats:cache:high",message:function(e,t){return e.hostname+" cache check failed. "+t.cache+"% CACHE in use"},subject:function(e,t){return"["+this.severity+"] "+e.hostname+" CACHE alert"}},{severity:"LOW",name:"host:stats:disk:high",message:function(e,t){return e.hostname+" disks check failed."},subject:function(e,t){return"["+this.severity+"] "+e.hostname+" DISK alert"}},{severity:"LOW",name:"host:stats:normal",message:function(e,t){return e.hostname+" stats recovered."},subject:function(e,t){return"["+this.severity+"] "+e.hostname+" STATS recovered"}}]},psaux:{type:"psaux",events:[]},host:{type:"host",events:[]},process:{type:"process",events:[]},script:{type:"script",events:[]},scraper:{type:"scraper",events:[]},service:{type:"service",events:[]}};module.exports=function(e,t,r,n){var s=e.type;try{var i=searchTypeEvent(s,t)}catch(e){return n(e,null)}return n(null,{content:i.message(e,r),subject:i.subject(e,r)})};
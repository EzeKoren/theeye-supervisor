"use strict";var resolver=require("../router/param-resolver"),Event=require("../entity/event").Event,async=require("async");module.exports=function(e,t){e.get("/:customer/event/:event",[t.authenticate("bearer",{session:!1}),resolver.customerNameToEntity({}),resolver.idToEntity({param:"event"})],controller.get),e.get("/:customer/event",[t.authenticate("bearer",{session:!1}),resolver.customerNameToEntity({})],controller.fetch)};var controller={get:function(e,t,r){e.event||e.send(404),e.send(200,e.event)},fetch:function(e,t,r){Event.find({customer:e.customer}).exec(function(e,r){async.each(r,function(e,t){return e.populate({path:"emitter",populate:{path:"host",model:"Host"}},t)},function(e){e&&t.send(500),t.send(200,r)})})}};
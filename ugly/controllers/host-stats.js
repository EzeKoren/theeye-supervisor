"use strict";var json=require("../lib/jsonresponse"),debug=require("../lib/logger")("eye:supervisor:controller:host-stats"),paramResolver=require("../router/param-resolver"),HostStats=require("../entity/host/stats").Entity;module.exports=function(e,t){return e.get("/host/:host/stats",[t.authenticate("bearer",{session:!1}),paramResolver.idToEntity({param:"host"})],controller.fetch),{routes:[{route:"/host/:host/stats",method:"get",middleware:[paramResolver.idToEntity({param:"host"})],action:controller.fetch}]}};var controller={fetch:function(e,t,r){var o=e.host,n=e.query.type,i={host_id:o._id};n&&(i.type=n),HostStats.find(i,function(e,r){if(e)debug.error("error fetching host stats"),t.send(500,json.failure("internal error"));else{var o=[];r.forEach(function(e){o.push(e.publish())}),t.send(200,{stats:o})}})}};
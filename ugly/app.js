"use strict";var restify=require("restify"),util=require("util"),multer=require("multer"),config=require("config"),router=require("./router"),strategys=require("./lib/auth/strategys"),logger=require("./lib/logger")("eye:supervisor:server"),app={start:function(){var e=restify.createServer(),r=strategys.setStrategy("bearer");e.pre(function(e,r,s){logger.log("REQUEST %s %s",e.method,e.url),s()}),e.use(restify.acceptParser(e.acceptable)),e.use(restify.gzipResponse()),e.use(restify.queryParser()),e.use(restify.jsonBodyParser()),e.use(r.initialize()),e.use(multer({dest:config.system.file_upload_folder,rename:function(e,r){return r}})),e.use(function(e,r,s){return r.header("Access-Control-Allow-Origin","*"),r.header("Access-Control-Allow-Methods","*"),s()}),e.on("uncaughtException",function(e,r,s,t){logger.error("Message Error: %s",t.message),logger.error("Stack %s",t.stack),r.send(500,"internal error")}),router.loadControllers(e,r),e.listen(config.server.port||60080,function(){logger.log('server started. "%s" listening at "%s"',e.name,e.url)})}};module.exports=app;